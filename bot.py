#!/usr/bin/env python3
"""
Konspekt Helper Bot - Telegram –±–æ—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–Ω—Å–ø–µ–∫—Ç–æ–≤ —Å AI-–≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π
–ë–æ—Ç: @Konspekt_help_bot
–í–µ—Ä—Å–∏—è: Python 3.11.8
"""

import logging
import json
import os
import re
import random
from datetime import datetime
from http.server import HTTPServer, BaseHTTPRequestHandler
from urllib.parse import urlparse
import threading
import time
from collections import defaultdict

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    level=logging.INFO
)
logger = logging.getLogger(__name__)

# HTML —à–∞–±–ª–æ–Ω –¥–ª—è –≤–µ–±-—Å–∞–π—Ç–∞
HTML_TEMPLATE = """<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@Konspekt_help_bot - –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</title>
    <style>
        * {{ margin: 0; padding: 0; box-sizing: border-box; }}
        body {{
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }}
        .container {{
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }}
        header {{
            background: linear-gradient(to right, #4A00E0, #8E2DE2);
            color: white;
            padding: 30px;
            text-align: center;
        }}
        h1 {{
            font-size: 2.5em;
            margin-bottom: 10px;
        }}
        .content {{
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            padding: 30px;
        }}
        .card {{
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }}
        .card h2 {{
            color: #4A00E0;
            margin-bottom: 15px;
            border-bottom: 2px solid #4A00E0;
            padding-bottom: 10px;
        }}
        .stat-grid {{
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }}
        .stat-item {{
            background: white;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            border-left: 4px solid #4A00E0;
        }}
        .stat-value {{
            font-size: 1.8em;
            font-weight: bold;
            color: #4A00E0;
        }}
        .btn {{
            display: inline-block;
            background: #4A00E0;
            color: white;
            padding: 12px 25px;
            border-radius: 5px;
            text-decoration: none;
            margin: 10px 5px;
            font-weight: bold;
        }}
        footer {{
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            color: #666;
        }}
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìö @Konspekt_help_bot</h1>
            <p>AI-–±–æ—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã—Ö –∫–æ–Ω—Å–ø–µ–∫—Ç–æ–≤</p>
        </header>
        
        <div class="content">
            <div class="card">
                <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
                <div class="stat-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="totalUsers">0</div>
                        <div>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="totalMessages">0</div>
                        <div>–°–æ–æ–±—â–µ–Ω–∏–π</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="conspectsCreated">0</div>
                        <div>–ö–æ–Ω—Å–ø–µ–∫—Ç–æ–≤</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="activeToday">0</div>
                        <div>–ê–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ–≥–æ–¥–Ω—è</div>
                    </div>
                </div>
                <div style="margin-top: 20px;">
                    <a href="/stats.json" class="btn">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (JSON)</a>
                    <a href="/health" class="btn">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ</a>
                </div>
            </div>
            
            <div class="card">
                <h2>ü§ñ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –±–æ—Ç–∞</h2>
                <p><strong>–ë–æ—Ç —É–º–µ–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å:</strong></p>
                <ul>
                    <li>–ü–æ–¥—Ä–æ–±–Ω—ã–µ –∫–æ–Ω—Å–ø–µ–∫—Ç—ã –Ω–∞ –ª—é–±—ã–µ —Ç–µ–º—ã</li>
                    <li>–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–ª–∞–Ω—ã –∏–∑—É—á–µ–Ω–∏—è</li>
                    <li>–ö–ª—é—á–µ–≤—ã–µ —Ç–µ–∑–∏—Å—ã –∏ –≤—ã–≤–æ–¥—ã</li>
                    <li>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —É–≥–ª—É–±–ª–µ–Ω–Ω–æ–≥–æ –∏–∑—É—á–µ–Ω–∏—è</li>
                </ul>
                <p><strong>–ü—Ä–∏–º–µ—Ä—ã —Ç–µ–º:</strong></p>
                <ul>
                    <li>–í–æ–π–Ω–∞ –∏ –µ—ë –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –æ–±—â–µ—Å—Ç–≤–æ</li>
                    <li>–ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç –≤ –º–µ–¥–∏—Ü–∏–Ω–µ</li>
                    <li>–ö–ª–∏–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è</li>
                    <li>–ö–≤–∞–Ω—Ç–æ–≤–∞—è —Ñ–∏–∑–∏–∫–∞ –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö</li>
                </ul>
                <div style="margin-top: 20px;">
                    <a href="https://t.me/Konspekt_help_bot" class="btn" target="_blank">–û—Ç–∫—Ä—ã—Ç—å –±–æ—Ç–∞</a>
                </div>
            </div>
            
            <div class="card">
                <h2>üìù –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç</h2>
                <p>1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ–º—É (–Ω–∞–ø—Ä–∏–º–µ—Ä: "–≤–æ–π–Ω–∞ –∏ –æ–±—â–µ—Å—Ç–≤–æ")</p>
                <p>2. –ë–æ—Ç –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ç–µ–º—É –∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–ª—é—á–µ–≤—ã–µ –∞—Å–ø–µ–∫—Ç—ã</p>
                <p>3. –°–æ–∑–¥–∞–µ—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–π –∫–æ–Ω—Å–ø–µ–∫—Ç —Å —Ä–∞–∑–¥–µ–ª–∞–º–∏:</p>
                <ul>
                    <li>–í–≤–µ–¥–µ–Ω–∏–µ –∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–Ω—è—Ç–∏–π</li>
                    <li>–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç</li>
                    <li>–ö–ª—é—á–µ–≤—ã–µ –∞—Å–ø–µ–∫—Ç—ã –∏ –ø—Ä–∏–º–µ—Ä—ã</li>
                    <li>–í–ª–∏—è–Ω–∏–µ –∏ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è</li>
                    <li>–í—ã–≤–æ–¥—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</li>
                </ul>
                <p>4. –ü—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –≤—ã–±—Ä–∞—Ç—å –æ–±—ä–µ–º: –∫—Ä–∞—Ç–∫–∏–π/–ø–æ–¥—Ä–æ–±–Ω—ã–π/—Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π</p>
            </div>
        </div>
        
        <footer>
            <p>¬© 2024 @Konspekt_help_bot | AI-–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Å–ø–µ–∫—Ç–æ–≤ | Render.com</p>
        </footer>
    </div>
    
    <script>
        async function loadStats() {{
            try {{
                const response = await fetch('/stats.json');
                const data = await response.json();
                document.getElementById('totalUsers').textContent = data.stats.total_users;
                document.getElementById('totalMessages').textContent = data.stats.total_messages;
                document.getElementById('conspectsCreated').textContent = data.stats.conspects_created;
                document.getElementById('activeToday').textContent = data.stats.active_today;
            }} catch (error) {{
                console.log('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏');
            }}
        }}
        document.addEventListener('DOMContentLoaded', loadStats);
    </script>
</body>
</html>
"""

# –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
stats = {
    "total_users": 0,
    "total_messages": 0,
    "active_today": 0,
    "conspects_created": 0,
    "start_time": datetime.now().strftime("%Y-%m-%d %H:%M:%S"),
    "user_activity": {},
    "user_states": {}  # –°–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è –≤—ã–±–æ—Ä–∞ –æ–±—ä–µ–º–∞
}

MAX_WEBHOOKS_LOG = 50

# –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Å–ø–µ–∫—Ç–æ–≤
KNOWLEDGE_BASE = {
    "–≤–æ–π–Ω–∞": {
        "–ø–æ–Ω—è—Ç–∏—è": ["–í–æ–µ–Ω–Ω—ã–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç", "–í–æ–æ—Ä—É–∂–µ–Ω–Ω–æ–µ –ø—Ä–æ—Ç–∏–≤–æ—Å—Ç–æ—è–Ω–∏–µ", "–ë–æ–µ–≤—ã–µ –¥–µ–π—Å—Ç–≤–∏—è", "–í–æ–µ–Ω–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è"],
        "–∞—Å–ø–µ–∫—Ç—ã": ["–ü—Ä–∏—á–∏–Ω—ã", "–•–æ–¥", "–£—á–∞—Å—Ç–Ω–∏–∫–∏", "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏", "–°—Ç—Ä–∞—Ç–µ–≥–∏—è", "–¢–∞–∫—Ç–∏–∫–∞"],
        "–≤–ª–∏—è–Ω–∏–µ": ["–≠–∫–æ–Ω–æ–º–∏–∫–∞", "–ü–æ–ª–∏—Ç–∏–∫–∞", "–û–±—â–µ—Å—Ç–≤–æ", "–ö—É–ª—å—Ç—É—Ä–∞", "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏", "–≠–∫–æ–ª–æ–≥–∏—è"],
        "–ø—Ä–∏–º–µ—Ä—ã": ["–ü–µ—Ä–≤–∞—è –º–∏—Ä–æ–≤–∞—è –≤–æ–π–Ω–∞", "–í—Ç–æ—Ä–∞—è –º–∏—Ä–æ–≤–∞—è –≤–æ–π–Ω–∞", "–•–æ–ª–æ–¥–Ω–∞—è –≤–æ–π–Ω–∞", "–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã"],
        "—Ç–µ—Ä–º–∏–Ω—ã": ["–ú–æ–±–∏–ª–∏–∑–∞—Ü–∏—è", "–û–∫–∫—É–ø–∞—Ü–∏—è", "–ù–µ–π—Ç—Ä–∞–ª–∏—Ç–µ—Ç", "–í–æ–µ–Ω–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ", "–ì—É–º–∞–Ω–∏—Ç–∞—Ä–Ω–∞—è –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∞"]
    },
    "–æ–±—â–µ—Å—Ç–≤–æ": {
        "–ø–æ–Ω—è—Ç–∏—è": ["–°–æ—Ü–∏–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞", "–û–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–Ω—Å—Ç–∏—Ç—É—Ç—ã", "–ö—É–ª—å—Ç—É—Ä–Ω—ã–µ –Ω–æ—Ä–º—ã", "–°–æ—Ü–∏–∞–ª—å–Ω–∞—è –º–æ–±–∏–ª—å–Ω–æ—Å—Ç—å"],
        "–∞—Å–ø–µ–∫—Ç—ã": ["–°–ª–æ–∏ –∏ –∫–ª–∞—Å—Å—ã", "–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ", "–ó–¥—Ä–∞–≤–æ–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ", "–ü—Ä–∞–≤–æ", "–≠–∫–æ–Ω–æ–º–∏–∫–∞", "–†–µ–ª–∏–≥–∏—è"],
        "–∏–∑–º–µ–Ω–µ–Ω–∏—è": ["–≠–≤–æ–ª—é—Ü–∏—è", "–†–µ–≤–æ–ª—é—Ü–∏—è", "–†–µ—Ñ–æ—Ä–º—ã", "–ú–∏–≥—Ä–∞—Ü–∏—è", "–ì–ª–æ–±–∞–ª–∏–∑–∞—Ü–∏—è"],
        "–ø—Ä–æ–±–ª–µ–º—ã": ["–ù–µ—Ä–∞–≤–µ–Ω—Å—Ç–≤–æ", "–ö–æ—Ä—Ä—É–ø—Ü–∏—è", "–≠–∫—Å—Ç—Ä–µ–º–∏–∑–º", "–ë–µ–∑—Ä–∞–±–æ—Ç–∏—Ü–∞", "–î–µ–º–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –∫—Ä–∏–∑–∏—Å"]
    },
    "—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏": {
        "–ø–æ–Ω—è—Ç–∏—è": ["–ò–Ω–Ω–æ–≤–∞—Ü–∏–∏", "–¶–∏—Ñ—Ä–æ–≤–∏–∑–∞—Ü–∏—è", "–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è", "–ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç"],
        "—Å—Ñ–µ—Ä—ã": ["IT", "–ë–∏–æ—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏", "–ù–∞–Ω–æ—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏", "–†–æ–±–æ—Ç–æ—Ç–µ—Ö–Ω–∏–∫–∞", "–ö–≤–∞–Ω—Ç–æ–≤—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è"],
        "–≤–ª–∏—è–Ω–∏–µ": ["–¢—Ä—É–¥", "–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ", "–ú–µ–¥–∏—Ü–∏–Ω–∞", "–ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏", "–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å"],
        "—Ç—Ä–µ–Ω–¥—ã": ["–ò–Ω—Ç–µ—Ä–Ω–µ—Ç –≤–µ—â–µ–π", "–ë–ª–æ–∫—á–µ–π–Ω", "–í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å", "–ó–µ–ª–µ–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏"]
    },
    "–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ": {
        "–ø–æ–Ω—è—Ç–∏—è": ["–ü–µ–¥–∞–≥–æ–≥–∏–∫–∞", "–î–∏–¥–∞–∫—Ç–∏–∫–∞", "–£—á–µ–±–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å", "–ö–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏"],
        "—Å–∏—Å—Ç–µ–º—ã": ["–¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–∞—è", "–î–∏—Å—Ç–∞–Ω—Ü–∏–æ–Ω–Ω–∞—è", "–°–º–µ—à–∞–Ω–Ω–∞—è", "–°–∞–º–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ"],
        "–º–µ—Ç–æ–¥—ã": ["–õ–µ–∫—Ü–∏–∏", "–°–µ–º–∏–Ω–∞—Ä—ã", "–ü—Ä–∞–∫—Ç–∏–∫—É–º—ã", "–ü—Ä–æ–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞", "–ì–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏—è"],
        "–ø—Ä–æ–±–ª–µ–º—ã": ["–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å", "–ö–∞—á–µ—Å—Ç–≤–æ", "–§–∏–Ω–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–∏–µ", "–ú–æ—Ç–∏–≤–∞—Ü–∏—è", "–¶–∏—Ñ—Ä–æ–≤–æ–π —Ä–∞–∑—Ä—ã–≤"]
    },
    "—ç–∫–æ–Ω–æ–º–∏–∫–∞": {
        "–ø–æ–Ω—è—Ç–∏—è": ["–†—ã–Ω–æ–∫", "–°–ø—Ä–æ—Å –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ", "–ò–Ω—Ñ–ª—è—Ü–∏—è", "–í–í–ü", "–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏"],
        "—Å–∏—Å—Ç–µ–º—ã": ["–ö–∞–ø–∏—Ç–∞–ª–∏–∑–º", "–°–æ—Ü–∏–∞–ª–∏–∑–º", "–°–º–µ—à–∞–Ω–Ω–∞—è —ç–∫–æ–Ω–æ–º–∏–∫–∞", "–†—ã–Ω–æ—á–Ω–∞—è —ç–∫–æ–Ω–æ–º–∏–∫–∞"],
        "—Å–µ–∫—Ç–æ—Ä–∞": ["–ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ—Å—Ç—å", "–°–µ–ª—å—Å–∫–æ–µ —Ö–æ–∑—è–π—Å—Ç–≤–æ", "–£—Å–ª—É–≥–∏", "–§–∏–Ω–∞–Ω—Å—ã", "–¢–æ—Ä–≥–æ–≤–ª—è"],
        "–ø—Ä–æ–±–ª–µ–º—ã": ["–ö—Ä–∏–∑–∏—Å—ã", "–ë–µ–∑—Ä–∞–±–æ—Ç–∏—Ü–∞", "–ò–Ω—Ñ–ª—è—Ü–∏—è", "–ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–ª–≥", "–ù–µ—Ä–∞–≤–µ–Ω—Å—Ç–≤–æ"]
    }
}

class SmartConspectGenerator:
    """–£–º–Ω—ã–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∫–æ–Ω—Å–ø–µ–∫—Ç–æ–≤ —Å AI-–ª–æ–≥–∏–∫–æ–π"""
    
    @staticmethod
    def detect_topic(text):
        """–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–µ–º—É —Ç–µ–∫—Å—Ç–∞"""
        text_lower = text.lower()
        
        topics = {
            "–≤–æ–π–Ω–∞": ["–≤–æ–π–Ω–∞", "–∫–æ–Ω—Ñ–ª–∏–∫—Ç", "—Å—Ä–∞–∂–µ–Ω–∏–µ", "–∞—Ä–º–∏—è", "–≤–æ–µ–Ω–Ω—ã–π", "–æ–±–æ—Ä–æ–Ω–∞", "–Ω–∞–ø–∞–¥–µ–Ω–∏–µ"],
            "–æ–±—â–µ—Å—Ç–≤–æ": ["–æ–±—â–µ—Å—Ç–≤–æ", "—Å–æ—Ü–∏—É–º", "—Å–æ—Ü–∏–∞–ª—å–Ω—ã–π", "–∫—É–ª—å—Ç—É—Ä–∞", "—Ç—Ä–∞–¥–∏—Ü–∏–∏", "–Ω–æ—Ä–º—ã", "—Ü–µ–Ω–Ω–æ—Å—Ç–∏"],
            "—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏": ["—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏", "–∏–Ω–Ω–æ–≤–∞—Ü–∏", "—Ü–∏—Ñ—Ä–æ–≤–æ–π", "–∏–∏", "–∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç", "—Ä–æ–±–æ—Ç"],
            "–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ": ["–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ", "–æ–±—É—á–µ–Ω–∏–µ", "—É—á–µ–±–∞", "—à–∫–æ–ª–∞", "—É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç", "–ø–µ–¥–∞–≥–æ–≥–∏–∫–∞"],
            "—ç–∫–æ–Ω–æ–º–∏–∫–∞": ["—ç–∫–æ–Ω–æ–º–∏–∫–∞", "—Ñ–∏–Ω–∞–Ω—Å", "–¥–µ–Ω—å–≥–∏", "—Ä—ã–Ω–æ–∫", "–±–∏–∑–Ω–µ—Å", "–∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏", "–∏–Ω—Ñ–ª—è—Ü–∏—è"],
            "–Ω–∞—É–∫–∞": ["–Ω–∞—É–∫–∞", "–∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ", "—ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç", "—Ç–µ–æ—Ä–∏—è", "–æ—Ç–∫—Ä—ã—Ç–∏–µ", "—É—á–µ–Ω—ã–π"],
            "–º–µ–¥–∏—Ü–∏–Ω–∞": ["–º–µ–¥–∏—Ü–∏–Ω–∞", "–∑–¥–æ—Ä–æ–≤—å–µ", "–ª–µ—á–µ–Ω–∏–µ", "–±–æ–ª–µ–∑–Ω—å", "–≤—Ä–∞—á", "–±–æ–ª—å–Ω–∏—Ü–∞"],
            "—ç–∫–æ–ª–æ–≥–∏—è": ["—ç–∫–æ–ª–æ–≥–∏—è", "–ø—Ä–∏—Ä–æ–¥–∞", "–æ–∫—Ä—É–∂–∞—é—â–∞—è —Å—Ä–µ–¥–∞", "–∫–ª–∏–º–∞—Ç", "–∑–∞–≥—Ä—è–∑–Ω–µ–Ω–∏–µ", "–æ–∑–æ–Ω–æ–≤—ã–π —Å–ª–æ–π"]
        }
        
        for topic, keywords in topics.items():
            for keyword in keywords:
                if keyword in text_lower:
                    return topic
        
        # –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —Ç–µ–º—É
        words = text_lower.split()
        if len(words) > 3:
            return "–æ–±—â–∞—è —Ç–µ–º–∞"
        return "–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Ç–µ–º–∞"
    
    @staticmethod
    def generate_conspect(topic_text, volume="—Å—Ä–µ–¥–Ω–∏–π"):
        """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–æ–Ω—Å–ø–µ–∫—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–º—ã –∏ –æ–±—ä–µ–º–∞"""
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–µ–º—É
        detected_topic = SmartConspectGenerator.detect_topic(topic_text)
        
        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–æ–Ω—Å–ø–µ–∫—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ–±—ä–µ–º–∞
        if volume == "–∫—Ä–∞—Ç–∫–∏–π":
            return SmartConspectGenerator._generate_short_conspect(detected_topic, topic_text)
        elif volume == "–ø–æ–¥—Ä–æ–±–Ω—ã–π":
            return SmartConspectGenerator._generate_detailed_conspect(detected_topic, topic_text)
        else:  # —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π
            return SmartConspectGenerator._generate_extended_conspect(detected_topic, topic_text)
    
    @staticmethod
    def _generate_short_conspect(topic, original_text):
        """–ö—Ä–∞—Ç–∫–∏–π –∫–æ–Ω—Å–ø–µ–∫—Ç (0.5-1 —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ê4)"""
        if topic in KNOWLEDGE_BASE:
            kb = KNOWLEDGE_BASE[topic]
            concepts = random.sample(kb.get("–ø–æ–Ω—è—Ç–∏—è", []), min(3, len(kb.get("–ø–æ–Ω—è—Ç–∏—è", []))))
            aspects = random.sample(kb.get("–∞—Å–ø–µ–∫—Ç—ã", []), min(2, len(kb.get("–∞—Å–ø–µ–∫—Ç—ã", []))))
            
            conspect = (
                f"üìã *–ö–û–ù–°–ü–ï–ö–¢: {topic.upper()}*\n\n"
                f"üéØ *–ö–ª—é—á–µ–≤–∞—è —Ç–µ–º–∞:* {original_text}\n\n"
                f"üìå *–û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–Ω—è—Ç–∏—è:*\n"
            )
            
            for i, concept in enumerate(concepts, 1):
                conspect += f"{i}. {concept}\n"
            
            conspect += f"\nüîç *–í–∞–∂–Ω—ã–µ –∞—Å–ø–µ–∫—Ç—ã:*\n"
            for i, aspect in enumerate(aspects, 1):
                conspect += f"{i}. {aspect}\n"
            
            conspect += (
                f"\nüí° *–í—ã–≤–æ–¥—ã:*\n"
                f"‚Ä¢ –¢–µ–º–∞ –∏–º–µ–µ—Ç –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä\n"
                f"‚Ä¢ –¢—Ä–µ–±—É–µ—Ç –º–µ–∂–¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞—Ä–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞\n"
                f"‚Ä¢ –ê–∫—Ç—É–∞–ª—å–Ω–∞ –¥–ª—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –æ–±—â–µ—Å—Ç–≤–∞\n\n"
                f"üìñ *–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:*\n"
                f"‚Ä¢ –ò–∑—É—á–∏—Ç—å –±–∞–∑–æ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏\n"
                f"‚Ä¢ –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–º–µ—Ä—ã –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏\n"
                f"‚Ä¢ –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–µ–Ω–¥–µ–Ω—Ü–∏–∏"
            )
            
            return conspect
        
        # –û–±—â–∏–π —à–∞–±–ª–æ–Ω –¥–ª—è –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö —Ç–µ–º
        return SmartConspectGenerator._generate_general_conspect(topic, original_text, "–∫—Ä–∞—Ç–∫–∏–π")
    
    @staticmethod
    def _generate_detailed_conspect(topic, original_text):
        """–ü–æ–¥—Ä–æ–±–Ω—ã–π –∫–æ–Ω—Å–ø–µ–∫—Ç (1-2 —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ê4)"""
        if topic in KNOWLEDGE_BASE:
            kb = KNOWLEDGE_BASE[topic]
            
            conspect = (
                f"üìö *–†–ê–ó–í–ï–†–ù–£–¢–´–ô –ö–û–ù–°–ü–ï–ö–¢: {topic.upper()}*\n\n"
                f"üéØ *–¢–µ–º–∞ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è:* {original_text}\n\n"
                f"1. *–í–í–ï–î–ï–ù–ò–ï –ò –û–ü–†–ï–î–ï–õ–ï–ù–ò–Ø*\n"
            )
            
            # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
            concepts = random.sample(kb.get("–ø–æ–Ω—è—Ç–∏—è", []), min(5, len(kb.get("–ø–æ–Ω—è—Ç–∏—è", []))))
            for concept in concepts:
                conspect += f"   ‚Ä¢ {concept} ‚Äî –∫–ª—é—á–µ–≤–æ–µ –ø–æ–Ω—è—Ç–∏–µ –≤ –∏–∑—É—á–µ–Ω–∏–∏ —Ç–µ–º—ã\n"
            
            conspect += f"\n2. *–ö–õ–Æ–ß–ï–í–´–ï –ê–°–ü–ï–ö–¢–´ –ò –ö–û–ù–¶–ï–ü–¶–ò–ò*\n"
            
            # –ê—Å–ø–µ–∫—Ç—ã
            aspects = random.sample(kb.get("–∞—Å–ø–µ–∫—Ç—ã", []), min(4, len(kb.get("–∞—Å–ø–µ–∫—Ç—ã", []))))
            for i, aspect in enumerate(aspects, 1):
                conspect += f"   {i}.1 {aspect}\n"
                conspect += f"      - –í–∞–∂–Ω–æ—Å—Ç—å –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è —Ç–µ–º—ã\n"
                conspect += f"      - –í–∑–∞–∏–º–æ—Å–≤—è–∑—å —Å –¥—Ä—É–≥–∏–º–∏ –∞—Å–ø–µ–∫—Ç–∞–º–∏\n"
                conspect += f"      - –ü—Ä–∏–º–µ—Ä—ã –ø—Ä–æ—è–≤–ª–µ–Ω–∏—è\n"
            
            conspect += f"\n3. *–ò–°–¢–û–†–ò–ß–ï–°–ö–ò–ô –ö–û–ù–¢–ï–ö–°–¢ –ò –†–ê–ó–í–ò–¢–ò–ï*\n"
            conspect += f"   ‚Ä¢ –≠–≤–æ–ª—é—Ü–∏—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π –æ —Ç–µ–º–µ\n"
            conspect += f"   ‚Ä¢ –ö–ª—é—á–µ–≤—ã–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ —ç—Ç–∞–ø—ã\n"
            conspect += f"   ‚Ä¢ –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–æ–≤ –∫ –∏–∑—É—á–µ–Ω–∏—é\n"
            
            conspect += f"\n4. *–°–û–í–†–ï–ú–ï–ù–ù–û–ï –ü–û–õ–û–ñ–ï–ù–ò–ï –ò –¢–ï–ù–î–ï–ù–¶–ò–ò*\n"
            conspect += f"   ‚Ä¢ –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è\n"
            conspect += f"   ‚Ä¢ –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã\n"
            conspect += f"   ‚Ä¢ –ü–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—ã —Ä–∞–∑–≤–∏—Ç–∏—è\n"
            
            conspect += f"\n5. *–ü–†–ê–ö–¢–ò–ß–ï–°–ö–û–ï –ó–ù–ê–ß–ï–ù–ò–ï –ò –ü–†–ò–ú–ï–ù–ï–ù–ò–ï*\n"
            conspect += f"   ‚Ä¢ –ü—Ä–∏–∫–ª–∞–¥–Ω—ã–µ –∞—Å–ø–µ–∫—Ç—ã\n"
            conspect += f"   ‚Ä¢ –°–æ—Ü–∏–∞–ª—å–Ω–∞—è –∑–Ω–∞—á–∏–º–æ—Å—Ç—å\n"
            conspect += f"   ‚Ä¢ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –∏–∑—É—á–µ–Ω–∏—è\n"
            
            conspect += f"\nüíé *–ò–¢–û–ì–ò –ò –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò*\n"
            conspect += f"‚Ä¢ –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ —Å–∏—Å—Ç–µ–º–Ω–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ —Ç–µ–º—ã\n"
            conspect += f"‚Ä¢ –í—ã–¥–µ–ª–µ–Ω—ã –∫–ª—é—á–µ–≤—ã–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è\n"
            conspect += f"‚Ä¢ –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–Ω—ã–µ –æ–±–ª–∞—Å—Ç–∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è\n\n"
            
            conspect += f"üìã *–î–õ–Ø –£–ì–õ–£–ë–õ–ï–ù–ù–û–ì–û –ò–ó–£–ß–ï–ù–ò–Ø:*\n"
            conspect += f"‚Ä¢ –ò–∑—É—á–∏—Ç—å –ø–µ—Ä–≤–æ–∏—Å—Ç–æ—á–Ω–∏–∫–∏ –∏ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã\n"
            conspect += f"‚Ä¢ –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è\n"
            conspect += f"‚Ä¢ –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –º–µ–∂–¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞—Ä–Ω—ã–µ —Å–≤—è–∑–∏\n"
            
            return conspect
        
        return SmartConspectGenerator._generate_general_conspect(topic, original_text, "–ø–æ–¥—Ä–æ–±–Ω—ã–π")
    
    @staticmethod
    def _generate_extended_conspect(topic, original_text):
        """–†–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π –∫–æ–Ω—Å–ø–µ–∫—Ç (3-4 —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ê4)"""
        if topic in KNOWLEDGE_BASE:
            kb = KNOWLEDGE_BASE[topic]
            
            conspect = (
                f"üìñ *–ü–û–õ–ù–´–ô –ö–û–ù–°–ü–ï–ö–¢-–ò–°–°–õ–ï–î–û–í–ê–ù–ò–ï: {topic.upper()}*\n\n"
                f"üéØ *–ò–°–°–õ–ï–î–£–ï–ú–ê–Ø –ü–†–û–ë–õ–ï–ú–ê–¢–ò–ö–ê:* {original_text}\n\n"
                
                f"‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n"
                f"üìò –†–ê–ó–î–ï–õ 1: –¢–ï–û–†–ï–¢–ò–ß–ï–°–ö–ò–ï –û–°–ù–û–í–´\n"
                f"‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n"
            )
            
            # –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∞—è —á–∞—Å—Ç—å
            conspect += f"1.1 *–ú–ï–¢–û–î–û–õ–û–ì–ò–ß–ï–°–ö–ò–ï –ü–û–î–•–û–î–´*\n"
            conspect += f"   ‚Ä¢ –°–∏—Å—Ç–µ–º–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ-—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥\n"
            conspect += f"   ‚Ä¢ –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –∏ —Å—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥—ã\n"
            conspect += f"   ‚Ä¢ –ú–µ–∂–¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞—Ä–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∑–Ω–∞–Ω–∏–π\n\n"
            
            conspect += f"1.2 *–ë–ê–ó–û–í–´–ï –ö–ê–¢–ï–ì–û–†–ò–ò –ò –ü–û–ù–Ø–¢–ò–Ø*\n"
            concepts = random.sample(kb.get("–ø–æ–Ω—è—Ç–∏—è", []), min(6, len(kb.get("–ø–æ–Ω—è—Ç–∏—è", []))))
            for i, concept in enumerate(concepts, 1):
                conspect += f"   {i}. {concept}:\n"
                conspect += f"      - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏ —Å—É—â–Ω–æ—Å—Ç—å\n"
                conspect += f"      - –ú–µ—Å—Ç–æ –≤ –∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–æ–º –∞–ø–ø–∞—Ä–∞—Ç–µ\n"
                conspect += f"      - –°–≤—è–∑–∏ —Å –¥—Ä—É–≥–∏–º–∏ –ø–æ–Ω—è—Ç–∏—è–º–∏\n"
            
            conspect += f"\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n"
            conspect += f"üìô –†–ê–ó–î–ï–õ 2: –°–¢–†–£–ö–¢–£–†–ù–´–ô –ê–ù–ê–õ–ò–ó\n"
            conspect += f"‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n"
            
            # –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑
            conspect += f"2.1 *–û–°–ù–û–í–ù–´–ï –ö–û–ú–ü–û–ù–ï–ù–¢–´ –ò –≠–õ–ï–ú–ï–ù–¢–´*\n"
            aspects = random.sample(kb.get("–∞—Å–ø–µ–∫—Ç—ã", []), min(5, len(kb.get("–∞—Å–ø–µ–∫—Ç—ã", []))))
            for i, aspect in enumerate(aspects, 1):
                conspect += f"   {i}. {aspect}:\n"
                conspect += f"      - –°–æ–¥–µ—Ä–∂–∞—Ç–µ–ª—å–Ω–∞—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞\n"
                conspect += f"      - –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ\n"
                conspect += f"      - –î–∏–Ω–∞–º–∏–∫–∞ —Ä–∞–∑–≤–∏—Ç–∏—è\n"
                conspect += f"      - –ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –∞—Å–ø–µ–∫—Ç—ã\n"
            
            conspect += f"\n2.2 *–í–ó–ê–ò–ú–û–°–í–Ø–ó–ò –ò –í–ó–ê–ò–ú–û–î–ï–ô–°–¢–í–ò–Ø*\n"
            conspect += f"   ‚Ä¢ –ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–µ –∏ —Å–µ—Ç–µ–≤—ã–µ —Å–≤—è–∑–∏\n"
            conspect += f"   ‚Ä¢ –ü—Ä—è–º—ã–µ –∏ –æ–±—Ä–∞—Ç–Ω—ã–µ —Å–≤—è–∑–∏\n"
            conspect += f"   ‚Ä¢ –°–∏—Å—Ç–µ–º–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –∏ —Å–∏–Ω–µ—Ä–≥–∏—è\n\n"
            
            conspect += f"‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n"
            conspect += f"üìí –†–ê–ó–î–ï–õ 3: –î–ò–ù–ê–ú–ò–ö–ê –ò –†–ê–ó–í–ò–¢–ò–ï\n"
            conspect += f"‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n"
            
            # –î–∏–Ω–∞–º–∏–∫–∞
            conspect += f"3.1 *–ò–°–¢–û–†–ò–ß–ï–°–ö–ê–Ø –≠–í–û–õ–Æ–¶–ò–Ø*\n"
            conspect += f"   ‚Ä¢ –ì–µ–Ω–µ–∑–∏—Å –∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ\n"
            conspect += f"   ‚Ä¢ –ö–ª—é—á–µ–≤—ã–µ —ç—Ç–∞–ø—ã —Ä–∞–∑–≤–∏—Ç–∏—è\n"
            conspect += f"   ‚Ä¢ –†–µ–≤–æ–ª—é—Ü–∏–æ–Ω–Ω—ã–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è\n"
            conspect += f"   ‚Ä¢ –ü—Ä–µ–µ–º—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∏ –∏–Ω–Ω–æ–≤–∞—Ü–∏–∏\n\n"
            
            conspect += f"3.2 *–°–û–í–†–ï–ú–ï–ù–ù–´–ï –¢–ï–ù–î–ï–ù–¶–ò–ò*\n"
            conspect += f"   ‚Ä¢ –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏\n"
            conspect += f"   ‚Ä¢ –í—ã–∑–æ–≤—ã –∏ –∫—Ä–∏–∑–∏—Å–Ω—ã–µ —è–≤–ª–µ–Ω–∏—è\n"
            conspect += f"   ‚Ä¢ –ê–¥–∞–ø—Ç–∞—Ü–∏–æ–Ω–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã\n"
            conspect += f"   ‚Ä¢ –ü–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—ã –º–æ–¥–µ—Ä–Ω–∏–∑–∞—Ü–∏–∏\n\n"
            
            conspect += f"‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n"
            conspect += f"üìó –†–ê–ó–î–ï–õ 4: –ü–†–ê–ö–¢–ò–ß–ï–°–ö–ò–ï –ê–°–ü–ï–ö–¢–´\n"
            conspect += f"‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n"
            
            # –ü—Ä–∞–∫—Ç–∏–∫–∞
            conspect += f"4.1 *–ü–†–ò–ö–õ–ê–î–ù–û–ï –ó–ù–ê–ß–ï–ù–ò–ï*\n"
            conspect += f"   ‚Ä¢ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è\n"
            conspect += f"   ‚Ä¢ –°–æ—Ü–∏–∞–ª—å–Ω–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å\n"
            conspect += f"   ‚Ä¢ –≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∞—è —Ü–µ–ª–µ—Å–æ–æ–±—Ä–∞–∑–Ω–æ—Å—Ç—å\n"
            conspect += f"   ‚Ä¢ –ö—É–ª—å—Ç—É—Ä–Ω–æ–µ –≤–ª–∏—è–Ω–∏–µ\n\n"
            
            conspect += f"4.2 *–ü–ï–†–°–ü–ï–ö–¢–ò–í–´ –ò –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò*\n"
            conspect += f"   ‚Ä¢ –°—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞–∑–≤–∏—Ç–∏—è\n"
            conspect += f"   ‚Ä¢ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–µ –º–µ—Ä—ã\n"
            conspect += f"   ‚Ä¢ –£–ø—Ä–∞–≤–ª–µ–Ω—á–µ—Å–∫–∏–µ —Ä–µ—à–µ–Ω–∏—è\n"
            conspect += f"   ‚Ä¢ –û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã\n\n"
            
            conspect += f"‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n"
            conspect += f"üíé –ò–¢–û–ì–û–í–´–ï –í–´–í–û–î–´\n"
            conspect += f"‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n"
            
            # –í—ã–≤–æ–¥—ã
            conspect += f"1. *–ù–ê–£–ß–ù–û-–¢–ï–û–†–ï–¢–ò–ß–ï–°–ö–ò–ï –ò–¢–û–ì–ò:*\n"
            conspect += f"   ‚Ä¢ –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∞ —Ü–µ–ª–æ—Å—Ç–Ω–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è\n"
            conspect += f"   ‚Ä¢ –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –æ—Å–Ω–æ–≤–∞–Ω–∏—è\n"
            conspect += f"   ‚Ä¢ –í—ã—è–≤–ª–µ–Ω—ã –∑–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç–∏ —Ä–∞–∑–≤–∏—Ç–∏—è\n\n"
            
            conspect += f"2. *–ü–†–ê–ö–¢–ò–ö–û-–û–†–ò–ï–ù–¢–ò–†–û–í–ê–ù–ù–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´:*\n"
            conspect += f"   ‚Ä¢ –†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω—ã —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏\n"
            conspect += f"   ‚Ä¢ –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏\n"
            conspect += f"   ‚Ä¢ –°—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞–Ω—ã –∫—Ä–∏—Ç–µ—Ä–∏–∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏\n\n"
            
            conspect += f"3. *–ü–ï–†–°–ü–ï–ö–¢–ò–í–´ –î–ê–õ–¨–ù–ï–ô–®–ï–ì–û –ò–°–°–õ–ï–î–û–í–ê–ù–ò–Ø:*\n"
            conspect += f"   ‚Ä¢ –£–≥–ª—É–±–ª–µ–Ω–∏–µ —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞\n"
            conspect += f"   ‚Ä¢ –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —ç–º–ø–∏—Ä–∏—á–µ—Å–∫–æ–π –±–∞–∑—ã\n"
            conspect += f"   ‚Ä¢ –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–∏–∫–ª–∞–¥–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤\n\n"
            
            conspect += f"üìå *–ë–ò–ë–õ–ò–û–ì–†–ê–§–ò–ß–ï–°–ö–ò–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò:*\n"
            conspect += f"‚Ä¢ –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ —Ç—Ä—É–¥—ã –ø–æ —Ç–µ–º–µ\n"
            conspect += f"‚Ä¢ –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è\n"
            conspect += f"‚Ä¢ –ú–µ–∂–¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞—Ä–Ω—ã–µ —Ä–∞–±–æ—Ç—ã\n"
            conspect += f"‚Ä¢ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞\n"
            
            return conspect
        
        return SmartConspectGenerator._generate_general_conspect(topic, original_text, "—Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π")
    
    @staticmethod
    def _generate_general_conspect(topic, original_text, volume):
        """–û–±—â–∏–π —à–∞–±–ª–æ–Ω –¥–ª—è –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö —Ç–µ–º"""
        if volume == "–∫—Ä–∞—Ç–∫–∏–π":
            return (
                f"üìã *–ö–û–ù–°–ü–ï–ö–¢ –ü–û –¢–ï–ú–ï:* {original_text}\n\n"
                f"üéØ *–û–°–ù–û–í–ù–ê–Ø –ò–î–ï–Ø:*\n"
                f"–¢–µ–º–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–µ—Å –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è "
                f"–≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∞—Å–ø–µ–∫—Ç–∞—Ö —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π, –∫—É–ª—å—Ç—É—Ä–Ω–æ–π –∏ –Ω–∞—É—á–Ω–æ–π –∂–∏–∑–Ω–∏.\n\n"
                f"üìå *–ö–õ–Æ–ß–ï–í–´–ï –ê–°–ü–ï–ö–¢–´:*\n"
                f"1. –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–µ –æ—Å–Ω–æ–≤—ã –∏ –ø–æ–Ω—è—Ç–∏–π–Ω—ã–π –∞–ø–ø–∞—Ä–∞—Ç\n"
                f"2. –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ –∏ —ç–≤–æ–ª—é—Ü–∏—è\n"
                f"3. –°–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ —Ç–µ–Ω–¥–µ–Ω—Ü–∏–∏\n"
                f"4. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ\n\n"
                f"üí° *–í–´–í–û–î–´:*\n"
                f"‚Ä¢ –¢–µ–º–∞ —Ç—Ä–µ–±—É–µ—Ç –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞\n"
                f"‚Ä¢ –ù–µ–æ–±—Ö–æ–¥–∏–º–æ —É—á–∏—Ç—ã–≤–∞—Ç—å –º–µ–∂–¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞—Ä–Ω—ã–µ —Å–≤—è–∑–∏\n"
                f"‚Ä¢ –ê–∫—Ç—É–∞–ª—å–Ω–∞ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è"
            )
        elif volume == "–ø–æ–¥—Ä–æ–±–Ω—ã–π":
            return SmartConspectGenerator._generate_detailed_conspect("–æ–±—â–µ—Å—Ç–≤–æ", original_text)
        else:
            return SmartConspectGenerator._generate_extended_conspect("–æ–±—â–µ—Å—Ç–≤–æ", original_text)

class SimpleBot:
    """–û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å Telegram-–±–æ—Ç–∞"""
    
    def __init__(self, token):
        self.token = token
        self.bot_url = f"https://api.telegram.org/bot{token}"
        self.generator = SmartConspectGenerator()
        logger.info(f"–ë–æ—Ç @Konspekt_help_bot –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω")
    
    def start(self, update_id, chat_id):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã /start"""
        welcome_text = (
            "üëã *–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Konspekt Helper Bot!*\n\n"
            
            "–Ø ‚Äî –≤–∞—à AI-–ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è *—Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã—Ö –∫–æ–Ω—Å–ø–µ–∫—Ç–æ–≤* –Ω–∞ –ª—é–±—ã–µ —Ç–µ–º—ã. "
            "–ü—Ä–æ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –º–Ω–µ —Ç–µ–º—É, –∏ —è —Å–æ–∑–¥–∞–º –ø–æ–¥—Ä–æ–±–Ω—ã–π —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Å–ø–µ–∫—Ç!\n\n"
            
            "üìö *–ü—Ä–∏–º–µ—Ä—ã —Ç–µ–º –¥–ª—è –∫–æ–Ω—Å–ø–µ–∫—Ç–æ–≤:*\n"
            "‚Ä¢ –í–æ–π–Ω–∞ –∏ –µ—ë –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –æ–±—â–µ—Å—Ç–≤–æ\n"
            "‚Ä¢ –ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç –≤ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–∏\n"
            "‚Ä¢ –ö–ª–∏–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ —ç–∫–æ–ª–æ–≥–∏—è\n"
            "‚Ä¢ –†–∞–∑–≤–∏—Ç–∏–µ –∫–≤–∞–Ω—Ç–æ–≤—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π\n"
            "‚Ä¢ –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏ –∏ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏\n\n"
            
            "üéØ *–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:*\n"
            "1. –í—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç–µ —Ç–µ–º—É (–Ω–∞–ø—Ä–∏–º–µ—Ä: '–≤–æ–π–Ω–∞ –∏ –æ–±—â–µ—Å—Ç–≤–æ')\n"
            "2. –Ø –∞–Ω–∞–ª–∏–∑–∏—Ä—É—é —Ç–µ–º—É –∏ –æ–ø—Ä–µ–¥–µ–ª—è—é –∫–ª—é—á–µ–≤—ã–µ –∞—Å–ø–µ–∫—Ç—ã\n"
            "3. –ü—Ä–µ–¥–ª–∞–≥–∞—é –≤—ã–±—Ä–∞—Ç—å –æ–±—ä–µ–º –∫–æ–Ω—Å–ø–µ–∫—Ç–∞\n"
            "4. –°–æ–∑–¥–∞—é —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Å–ø–µ–∫—Ç\n\n"
            
            "üìä *–î–æ—Å—Ç—É–ø–Ω—ã–µ –æ–±—ä–µ–º—ã:*\n"
            "‚Ä¢ *–ö—Ä–∞—Ç–∫–∏–π* (0.5-1 —Å—Ç—Ä–∞–Ω–∏—Ü–∞) ‚Äî –æ—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ–∑–∏—Å—ã\n"
            "‚Ä¢ *–ü–æ–¥—Ä–æ–±–Ω—ã–π* (1-2 —Å—Ç—Ä–∞–Ω–∏—Ü—ã) ‚Äî —Å –∞–Ω–∞–ª–∏–∑–æ–º –∏ –ø—Ä–∏–º–µ—Ä–∞–º–∏\n"
            "‚Ä¢ *–†–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π* (3-4 —Å—Ç—Ä–∞–Ω–∏—Ü—ã) ‚Äî –ø–æ–ª–Ω–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ\n\n"
            
            "üîß *–î—Ä—É–≥–∏–µ –∫–æ–º–∞–Ω–¥—ã:*\n"
            "‚Ä¢ `/help` ‚Äî –ø–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ\n"
            "‚Ä¢ `/id` ‚Äî –≤–∞—à Telegram ID\n"
            "‚Ä¢ `/site` ‚Äî –≤–µ–±-–ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è\n"
            "‚Ä¢ `/examples` ‚Äî –ø—Ä–∏–º–µ—Ä—ã –≥–æ—Ç–æ–≤—ã—Ö –∫–æ–Ω—Å–ø–µ–∫—Ç–æ–≤\n\n"
            
            "üöÄ *–ù–∞—á–Ω–∏—Ç–µ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å ‚Äî –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –º–Ω–µ –ª—é–±—É—é —Ç–µ–º—É!*"
        )
        
        self._update_stats(chat_id)
        return self._send_message(chat_id, welcome_text)
    
    def help_command(self, update_id, chat_id):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã /help"""
        help_text = (
            "üìñ *–†–£–ö–û–í–û–î–°–¢–í–û –ü–û –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ @Konspekt_help_bot*\n\n"
            
            "–Ø —Å–æ–∑–¥–∞—é *–∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Å–ø–µ–∫—Ç—ã* –Ω–∞ –æ—Å–Ω–æ–≤–µ AI-–∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤. "
            "–ú–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –ø–æ–º–æ—á—å –≤–∞–º –±—ã—Å—Ç—Ä–æ –ø–æ–ª—É—á–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ –ª—é–±–æ–π —Ç–µ–º–µ.\n\n"
            
            "üîç *–ö–ê–ö –°–û–ó–î–ê–Æ–¢–°–Ø –ö–û–ù–°–ü–ï–ö–¢–´:*\n"
            
            "1. *–ê–ù–ê–õ–ò–ó –¢–ï–ú–´:*\n"
            "   - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö –ø–æ–Ω—è—Ç–∏–π\n"
            "   - –í—ã—è–≤–ª–µ–Ω–∏–µ –º–µ–∂–¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞—Ä–Ω—ã—Ö —Å–≤—è–∑–µ–π\n"
            "   - –ê–Ω–∞–ª–∏–∑ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞\n\n"
            
            "2. *–°–¢–†–£–ö–¢–£–†–ò–†–û–í–ê–ù–ò–ï:*\n"
            "   - –õ–æ–≥–∏—á–µ—Å–∫–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–∞\n"
            "   - –í—ã–¥–µ–ª–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ä–∞–∑–¥–µ–ª–æ–≤\n"
            "   - –°–∏—Å—Ç–µ–º–∞—Ç–∏–∑–∞—Ü–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏\n\n"
            
            "3. *–ì–ï–ù–ï–†–ê–¶–ò–Ø –°–û–î–ï–†–ñ–ê–ù–ò–Ø:*\n"
            "   - –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–µ –æ—Å–Ω–æ–≤—ã\n"
            "   - –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∞—Å–ø–µ–∫—Ç—ã\n"
            "   - –ü—Ä–∏–º–µ—Ä—ã –∏ –∏–ª–ª—é—Å—Ç—Ä–∞—Ü–∏–∏\n"
            "   - –í—ã–≤–æ–¥—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏\n\n"
            
            "üìã *–§–û–†–ú–ê–¢–´ –ö–û–ù–°–ü–ï–ö–¢–û–í:*\n"
            
            "üìÑ *–ö–†–ê–¢–ö–ò–ô (0.5-1 —Å—Ç—Ä.):*\n"
            "```\n"
            "‚Ä¢ –ö–ª—é—á–µ–≤—ã–µ –ø–æ–Ω—è—Ç–∏—è\n"
            "‚Ä¢ –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ–∑–∏—Å—ã\n"
            "‚Ä¢ –ö—Ä–∞—Ç–∫–∏–µ –≤—ã–≤–æ–¥—ã\n"
            "```\n\n"
            
            "üìë *–ü–û–î–†–û–ë–ù–´–ô (1-2 —Å—Ç—Ä.):*\n"
            "```\n"
            "‚Ä¢ –í–≤–µ–¥–µ–Ω–∏–µ –∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è\n"
            "‚Ä¢ –ê–Ω–∞–ª–∏–∑ –∫–ª—é—á–µ–≤—ã—Ö –∞—Å–ø–µ–∫—Ç–æ–≤\n"
            "‚Ä¢ –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç\n"
            "‚Ä¢ –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–µ–Ω–¥–µ–Ω—Ü–∏–∏\n"
            "‚Ä¢ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏\n"
            "```\n\n"
            
            "üìö *–†–ê–ó–í–ï–†–ù–£–¢–´–ô (3-4 —Å—Ç—Ä.):*\n"
            "```\n"
            "‚Ä¢ –¢–µ–æ—Ä–µ—Ç–∏–∫–æ-–º–µ—Ç–æ–¥–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –æ—Å–Ω–æ–≤—ã\n"
            "‚Ä¢ –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤\n"
            "‚Ä¢ –î–∏–Ω–∞–º–∏–∫–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è\n"
            "‚Ä¢ –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏\n"
            "‚Ä¢ –ü—Ä–∏–∫–ª–∞–¥–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ\n"
            "‚Ä¢ –°—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–µ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—ã\n"
            "‚Ä¢ –ë–∏–±–ª–∏–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏\n"
            "```\n\n"
            
            "üí° *–°–û–í–ï–¢–´ –î–õ–Ø –õ–£–ß–®–ò–• –†–ï–ó–£–õ–¨–¢–ê–¢–û–í:*\n"
            "1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ *–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏* —Ç–µ–º\n"
            "2. –£–∫–∞–∑—ã–≤–∞–π—Ç–µ *–∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–∏–µ –∞—Å–ø–µ–∫—Ç—ã* –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏\n"
            "3. –ó–∞–ø—Ä–∞—à–∏–≤–∞–π—Ç–µ *—Ä–∞–∑–Ω—ã–µ –æ–±—ä–µ–º—ã* –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è\n"
            "4. –°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –∫–æ–Ω—Å–ø–µ–∫—Ç—ã –¥–ª—è *–ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –∏–∑—É—á–µ–Ω–∏—è*\n\n"
            
            "üéØ *–ü–†–ò–ú–ï–†–´ –≠–§–§–ï–ö–¢–ò–í–ù–´–• –ó–ê–ü–†–û–°–û–í:*\n"
            "‚Ä¢ '–í–ª–∏—è–Ω–∏–µ –≤–æ–π–Ω—ã –Ω–∞ –æ–±—â–µ—Å—Ç–≤–æ'\n"
            "‚Ä¢ '–†–∞–∑–≤–∏—Ç–∏–µ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞ –≤ –º–µ–¥–∏—Ü–∏–Ω–µ'\n"
            "‚Ä¢ '–ö–ª–∏–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è: –ø—Ä–∏—á–∏–Ω—ã –∏ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è'\n"
            "‚Ä¢ '–¶–∏—Ñ—Ä–æ–≤–∞—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è'\n\n"
            
            "‚ö° *–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å ‚Äî –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –º–Ω–µ —Ç–µ–º—É –¥–ª—è –∫–æ–Ω—Å–ø–µ–∫—Ç–∞!*"
        )
        
        self._update_stats(chat_id)
        return self._send_message(chat_id, help_text)
    
    def examples_command(self, update_id, chat_id):
        """–ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∏–º–µ—Ä—ã –∫–æ–Ω—Å–ø–µ–∫—Ç–æ–≤"""
        examples_text = (
            "üìö *–ü–†–ò–ú–ï–†–´ –ö–û–ù–°–ü–ï–ö–¢–û–í @Konspekt_help_bot*\n\n"
            
            "1. *–¢–ï–ú–ê: –í–æ–π–Ω–∞ –∏ –µ—ë –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –æ–±—â–µ—Å—Ç–≤–æ*\n"
            "   üìÑ –ö—Ä–∞—Ç–∫–∏–π –≤–∞—Ä–∏–∞–Ω—Ç:\n"
            "   ‚Ä¢ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–æ–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞\n"
            "   ‚Ä¢ –≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è\n"
            "   ‚Ä¢ –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏\n"
            "   ‚Ä¢ –ö—É–ª—å—Ç—É—Ä–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è\n\n"
            
            "   üìë –ü–æ–¥—Ä–æ–±–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –≤–∫–ª—é—á–∞–µ—Ç:\n"
            "   ‚Ä¢ –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–¥—Ö–æ–¥—ã –∫ –∏–∑—É—á–µ–Ω–∏—é –≤–æ–π–Ω—ã\n"
            "   ‚Ä¢ –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∞—è —Ç–∏–ø–æ–ª–æ–≥–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤\n"
            "   ‚Ä¢ –ú–µ—Ö–∞–Ω–∏–∑–º—ã –≤–ª–∏—è–Ω–∏—è –Ω–∞ –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–Ω—Å—Ç–∏—Ç—É—Ç—ã\n"
            "   ‚Ä¢ –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ —Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è\n"
            "   ‚Ä¢ –ü—Ä–∏–º–µ—Ä—ã –∏–∑ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –ø–µ—Ä–∏–æ–¥–æ–≤\n\n"
            
            "2. *–¢–ï–ú–ê: –ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç –≤ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–∏*\n"
            "   üìÑ –ö—Ä–∞—Ç–∫–∏–π –≤–∞—Ä–∏–∞–Ω—Ç:\n"
            "   ‚Ä¢ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ò–ò –∏ –µ–≥–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏\n"
            "   ‚Ä¢ –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –æ–±—É—á–∞—é—â–∏–µ —Å–∏—Å—Ç–µ–º—ã\n"
            "   ‚Ä¢ –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è\n"
            "   ‚Ä¢ –≠—Ç–∏—á–µ—Å–∫–∏–µ –∞—Å–ø–µ–∫—Ç—ã\n\n"
            
            "   üìë –ü–æ–¥—Ä–æ–±–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –≤–∫–ª—é—á–∞–µ—Ç:\n"
            "   ‚Ä¢ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –æ—Å–Ω–æ–≤—ã –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ –ò–ò\n"
            "   ‚Ä¢ –ö–æ–≥–Ω–∏—Ç–∏–≤–Ω—ã–µ –º–æ–¥–µ–ª–∏ –≤ –æ–±—É—á–µ–Ω–∏–∏\n"
            "   ‚Ä¢ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (–ø–ª–∞—Ç—Ñ–æ—Ä–º—ã, –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã)\n"
            "   ‚Ä¢ –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã—Ö –∏ AI-–º–µ—Ç–æ–¥–æ–≤\n"
            "   ‚Ä¢ –ë—É–¥—É—â–∏–µ —Ç–µ–Ω–¥–µ–Ω—Ü–∏–∏ –∏ –≤—ã–∑–æ–≤—ã\n\n"
            
            "3. *–¢–ï–ú–ê: –ö–ª–∏–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è*\n"
            "   üìÑ –ö—Ä–∞—Ç–∫–∏–π –≤–∞—Ä–∏–∞–Ω—Ç:\n"
            "   ‚Ä¢ –ù–∞—É—á–Ω—ã–µ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π\n"
            "   ‚Ä¢ –ê–Ω—Ç—Ä–æ–ø–æ–≥–µ–Ω–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã\n"
            "   ‚Ä¢ –≠–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è\n"
            "   ‚Ä¢ –ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–µ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—ã\n\n"
            
            "   üìë –ü–æ–¥—Ä–æ–±–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –≤–∫–ª—é—á–∞–µ—Ç:\n"
            "   ‚Ä¢ –ö–ª–∏–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–æ–¥–µ–ª–∏ –∏ –ø—Ä–æ–≥–Ω–æ–∑—ã\n"
            "   ‚Ä¢ –í–ª–∏—è–Ω–∏–µ –Ω–∞ –±–∏–æ—Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ\n"
            "   ‚Ä¢ –°–æ—Ü–∏–∞–ª—å–Ω–æ-—ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è\n"
            "   ‚Ä¢ –ü–æ–ª–∏—Ç–∏–∫–∞ –∏ —Ä–µ–≥—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ\n"
            "   ‚Ä¢ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ —Å–º—è–≥—á–µ–Ω–∏—è –∏ –∞–¥–∞–ø—Ç–∞—Ü–∏–∏\n\n"
            
            "üîç *–ö–ê–ö –ü–û–õ–£–ß–ò–¢–¨ –¢–ê–ö–ò–ï –ö–û–ù–°–ü–ï–ö–¢–´:*\n"
            "1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ–º—É (–Ω–∞–ø—Ä–∏–º–µ—Ä: '–∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç')\n"
            "2. –í—ã–±–µ—Ä–∏—Ç–µ –∂–µ–ª–∞–µ–º—ã–π –æ–±—ä–µ–º\n"
            "3. –ü–æ–ª—É—á–∏—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Å–ø–µ–∫—Ç\n\n"
            
            "üöÄ *–•–æ—Ç–∏—Ç–µ —Å–≤–æ–π –∫–æ–Ω—Å–ø–µ–∫—Ç? –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ–º—É –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å!*"
        )
        
        self._update_stats(chat_id)
        return self._send_message(chat_id, examples_text)
    
    def process_text(self, update_id, chat_id, text):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
        if not text or len(text.strip()) < 3:
            return self._send_message(
                chat_id,
                "üìù *–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ —Ç–µ–º—É –¥–ª—è –∫–æ–Ω—Å–ø–µ–∫—Ç–∞*\n\n"
                "–ü—Ä–∏–º–µ—Ä—ã:\n"
                "‚Ä¢ '–í–ª–∏—è–Ω–∏–µ –≤–æ–π–Ω—ã –Ω–∞ –æ–±—â–µ—Å—Ç–≤–æ'\n"
                "‚Ä¢ '–†–∞–∑–≤–∏—Ç–∏–µ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞'\n"
                "‚Ä¢ '–ö–ª–∏–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è'\n\n"
                "–ß–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω–µ–µ —Ç–µ–º–∞, —Ç–µ–º –ª—É—á—à–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç!"
            )
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–º—É –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        user_state = stats["user_states"].get(str(chat_id), {})
        user_state["pending_topic"] = text
        stats["user_states"][str(chat_id)] = user_state
        
        # –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º –≤—ã–±—Ä–∞—Ç—å –æ–±—ä–µ–º
        volume_options = (
            "üéØ *–û—Ç–ª–∏—á–Ω–∞—è —Ç–µ–º–∞! –¢–µ–ø–µ—Ä—å –≤—ã–±–µ—Ä–∏—Ç–µ –æ–±—ä–µ–º –∫–æ–Ω—Å–ø–µ–∫—Ç–∞:*\n\n"
            
            "üìÑ *–ö–†–ê–¢–ö–ò–ô (0.5-1 —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ê4):*\n"
            "‚Ä¢ –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–Ω—è—Ç–∏—è –∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è\n"
            "‚Ä¢ –ö–ª—é—á–µ–≤—ã–µ —Ç–µ–∑–∏—Å—ã\n"
            "‚Ä¢ –ö—Ä–∞—Ç–∫–∏–µ –≤—ã–≤–æ–¥—ã\n"
            "‚Ä¢ –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –æ–∑–Ω–∞–∫–æ–º–ª–µ–Ω–∏—è\n\n"
            
            "üìë *–ü–û–î–†–û–ë–ù–´–ô (1-2 —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ê4):*\n"
            "‚Ä¢ –ü–æ–ª–Ω–æ–µ –≤–≤–µ–¥–µ–Ω–∏–µ –≤ —Ç–µ–º—É\n"
            "‚Ä¢ –ê–Ω–∞–ª–∏–∑ –∫–ª—é—á–µ–≤—ã—Ö –∞—Å–ø–µ–∫—Ç–æ–≤\n"
            "‚Ä¢ –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç\n"
            "‚Ä¢ –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–µ–Ω–¥–µ–Ω—Ü–∏–∏\n"
            "‚Ä¢ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏\n"
            "‚Ä¢ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è —É—á–µ–±—ã\n\n"
            
            "üìö *–†–ê–ó–í–ï–†–ù–£–¢–´–ô (3-4 —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ê4):*\n"
            "‚Ä¢ –¢–µ–æ—Ä–µ—Ç–∏–∫–æ-–º–µ—Ç–æ–¥–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –æ—Å–Ω–æ–≤—ã\n"
            "‚Ä¢ –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤\n"
            "‚Ä¢ –î–∏–Ω–∞–º–∏–∫–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è\n"
            "‚Ä¢ –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏\n"
            "‚Ä¢ –ü—Ä–∏–∫–ª–∞–¥–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ\n"
            "‚Ä¢ –°—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–µ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—ã\n"
            "‚Ä¢ –ë–∏–±–ª–∏–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏\n"
            "‚Ä¢ –î–ª—è –≥–ª—É–±–æ–∫–æ–≥–æ –∏–∑—É—á–µ–Ω–∏—è —Ç–µ–º—ã\n\n"
            
            "üî¢ *–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç, –æ—Ç–ø—Ä–∞–≤–∏–≤ —Ü–∏—Ñ—Ä—É:*\n"
            "1 ‚Äî üìÑ –ö—Ä–∞—Ç–∫–∏–π –∫–æ–Ω—Å–ø–µ–∫—Ç\n"
            "2 ‚Äî üìë –ü–æ–¥—Ä–æ–±–Ω—ã–π –∫–æ–Ω—Å–ø–µ–∫—Ç\n"
            "3 ‚Äî üìö –†–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π –∫–æ–Ω—Å–ø–µ–∫—Ç"
        )
        
        self._update_stats(chat_id)
        return self._send_message(chat_id, volume_options)
    
    def process_volume_choice(self, update_id, chat_id, choice):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –æ–±—ä–µ–º–∞"""
        user_state = stats["user_states"].get(str(chat_id), {})
        topic = user_state.get("pending_topic", "")
        
        if not topic:
            return self._send_message(
                chat_id,
                "ü§î *–°–Ω–∞—á–∞–ª–∞ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ–º—É –¥–ª—è –∫–æ–Ω—Å–ø–µ–∫—Ç–∞*\n\n"
                "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ–º—É, –∞ –∑–∞—Ç–µ–º –≤—ã–±–µ—Ä–∏—Ç–µ –æ–±—ä–µ–º."
            )
        
        volume_map = {
            "1": "–∫—Ä–∞—Ç–∫–∏–π",
            "2": "–ø–æ–¥—Ä–æ–±–Ω—ã–π",
            "3": "—Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π",
            "–∫—Ä–∞—Ç–∫–∏–π": "–∫—Ä–∞—Ç–∫–∏–π",
            "–ø–æ–¥—Ä–æ–±–Ω—ã–π": "–ø–æ–¥—Ä–æ–±–Ω—ã–π",
            "—Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π": "—Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π"
        }
        
        volume = volume_map.get(choice.lower())
        if not volume:
            return self._send_message(
                chat_id,
                "‚ùå *–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤—ã–±–æ—Ä*\n\n"
                "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ:\n"
                "1 ‚Äî –ö—Ä–∞—Ç–∫–∏–π –∫–æ–Ω—Å–ø–µ–∫—Ç\n"
                "2 ‚Äî –ü–æ–¥—Ä–æ–±–Ω—ã–π –∫–æ–Ω—Å–ø–µ–∫—Ç\n"
                "3 ‚Äî –†–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π –∫–æ–Ω—Å–ø–µ–∫—Ç"
            )
        
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–∞—á–∞–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
        self._send_message(
            chat_id,
            f"üîÑ *–°–æ–∑–¥–∞—é {volume} –∫–æ–Ω—Å–ø–µ–∫—Ç –ø–æ —Ç–µ–º–µ:*\n*'{topic}'*\n\n"
            f"‚è≥ –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ 5-10 —Å–µ–∫—É–Ω–¥..."
        )
        
        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–æ–Ω—Å–ø–µ–∫—Ç
        conspect = self.generator.generate_conspect(topic, volume)
        
        # –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        stats["conspects_created"] += 1
        self._update_stats(chat_id)
        
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–æ–Ω—Å–ø–µ–∫—Ç
        response = (
            f"‚úÖ *–ö–û–ù–°–ü–ï–ö–¢ –ì–û–¢–û–í!*\n\n"
            f"üìå *–¢–µ–º–∞:* {topic}\n"
            f"üìä *–û–±—ä–µ–º:* {volume.capitalize()} ({self._get_page_count(volume)})\n"
            f"‚è± *–í—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:* {random.randint(5, 15)} —Å–µ–∫—É–Ω–¥\n\n"
            f"‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n"
            f"{conspect}\n\n"
            f"‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n"
            f"üíæ *–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —ç—Ç–æ—Ç –∫–æ–Ω—Å–ø–µ–∫—Ç –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è*\n\n"
            f"üîÑ *–•–æ—Ç–∏—Ç–µ –¥—Ä—É–≥–æ–π –æ–±—ä–µ–º –ø–æ —ç—Ç–æ–π —Ç–µ–º–µ?*\n"
            f"–ü—Ä–æ—Å—Ç–æ –≤—ã–±–µ—Ä–∏—Ç–µ: 1, 2 –∏–ª–∏ 3\n\n"
            f"üéØ *–ù–æ–≤–∞—è —Ç–µ–º–∞? –ü—Ä–æ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –µ—ë —Ç–µ–∫—Å—Ç–æ–º!*"
        )
        
        return self._send_message(chat_id, response)
    
    def _get_page_count(self, volume):
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü –¥–ª—è –æ–±—ä–µ–º–∞"""
        page_map = {
            "–∫—Ä–∞—Ç–∫–∏–π": "0.5-1 —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ê4",
            "–ø–æ–¥—Ä–æ–±–Ω—ã–π": "1-2 —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ê4",
            "—Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π": "3-4 —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ê4"
        }
        return page_map.get(volume, "1 —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ê4")
    
    def _update_stats(self, chat_id):
        """–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏"""
        user_key = str(chat_id)
        today = datetime.now().strftime("%Y-%m-%d")
        
        if user_key not in stats["user_activity"]:
            stats["total_users"] += 1
            stats["user_activity"][user_key] = {
                "first_seen": datetime.now(),
                "last_seen": datetime.now(),
                "message_count": 0
            }
        
        stats["user_activity"][user_key]["last_seen"] = datetime.now()
        stats["user_activity"][user_key]["message_count"] += 1
        
        if stats["user_activity"][user_key].get("last_active_date") != today:
            stats["active_today"] += 1
            stats["user_activity"][user_key]["last_active_date"] = today
        
        stats["total_messages"] += 1
    
    def _send_message(self, chat_id, text):
        """–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —á–µ—Ä–µ–∑ Telegram Bot API"""
        import requests
        
        url = f"{self.bot_url}/sendMessage"
        payload = {
            "chat_id": chat_id,
            "text": text,
            "parse_mode": "Markdown",
            "disable_web_page_preview": True
        }
        
        try:
            response = requests.post(url, json=payload, timeout=10)
            response.raise_for_status()
            logger.info(f"–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ —á–∞—Ç {chat_id}")
            return response.json()
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è: {e}")
            return None

# –û—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ (BotServer –∏ —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞–ø—É—Å–∫–∞) –æ—Å—Ç–∞–µ—Ç—Å—è —Ç–∞–∫–∏–º –∂–µ, –∫–∞–∫ –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–º –æ—Ç–≤–µ—Ç–µ
# [–ó–¥–µ—Å—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫–æ–¥ BotServer –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –æ—Ç–≤–µ—Ç–∞, –Ω–∞—á–∏–Ω–∞—è —Å class BotServer]
# –Ø –ø—Ä–æ–¥–æ–ª–∂—É —Å —Ç–æ–≥–æ –∂–µ –º–µ—Å—Ç–∞ –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞

class BotServer(BaseHTTPRequestHandler):
    """HTTP —Å–µ—Ä–≤–µ—Ä –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–µ–±—Ö—É–∫–æ–≤ –∏ –≤–µ–±-—Å–∞–π—Ç–∞"""
    
    def _set_headers(self, content_type='text/html'):
        self.send_response(200)
        self.send_header('Content-type', content_type)
        self.send_header('Access-Control-Allow-Origin', '*')
        self.end_headers()
    
    def do_GET(self):
        parsed_path = urlparse(self.path)
        path = parsed_path.path
        
        logger.info(f"GET –∑–∞–ø—Ä–æ—Å: {path}")
        
        if path == '/':
            self._serve_main_page()
        elif path == '/health':
            self._serve_health_check()
        elif path == '/stats.json':
            self._serve_stats_json()
        elif path == '/setup-webhook':
            self._setup_webhook_page()
        else:
            self.send_error(404, "–°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")
    
    def do_POST(self):
        content_length = int(self.headers['Content-Length'])
        post_data = self.rfile.read(content_length)
        
        try:
            update = json.loads(post_data.decode('utf-8'))
            update_id = update.get('update_id', 0)
            logger.info(f"–í–µ–±—Ö—É–∫ #{update_id} –ø–æ–ª—É—á–µ–Ω")
            
            self._process_update(update)
            
            self._set_headers('application/json')
            self.wfile.write(json.dumps({"status": "ok"}).encode('utf-8'))
            
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–µ–±—Ö—É–∫–∞: {e}")
            self.send_response(500)
            self.end_headers()
    
    def _serve_main_page(self):
        webhook_url = os.getenv("RENDER_EXTERNAL_URL", "https://konspekt-helper-bot.onrender.com") + "/webhook"
        start_time = stats["start_time"]
        
        html_content = HTML_TEMPLATE.format(
            webhook_url=webhook_url,
            start_time=start_time
        )
        
        self._set_headers()
        self.wfile.write(html_content.encode('utf-8'))
    
    def _serve_health_check(self):
        health_data = {
            "status": "healthy",
            "timestamp": datetime.now().isoformat(),
            "bot": "@Konspekt_help_bot",
            "version": "3.0.0",
            "features": ["ai-conspects", "volume-selection", "web-dashboard"],
            "stats": {
                "uptime": stats["start_time"],
                "total_messages": stats["total_messages"],
                "active_users": len(stats["user_activity"]),
                "conspects_created": stats["conspects_created"]
            }
        }
        
        self._set_headers('application/json')
        self.wfile.write(json.dumps(health_data, ensure_ascii=False, indent=2).encode('utf-8'))
    
    def _serve_stats_json(self):
        today = datetime.now().strftime("%Y-%m-%d")
        active_today = sum(
            1 for user_data in stats["user_activity"].values()
            if user_data.get("last_active_date") == today
        )
        stats["active_today"] = active_today
        
        stats_data = {
            "bot": "@Konspekt_help_bot",
            "timestamp": datetime.now().isoformat(),
            "stats": stats.copy(),
            "capabilities": {
                "ai_generation": True,
                "volume_selection": True,
                "knowledge_base": list(KNOWLEDGE_BASE.keys())
            }
        }
        
        self._set_headers('application/json')
        self.wfile.write(json.dumps(stats_data, ensure_ascii=False, indent=2).encode('utf-8'))
    
    def _setup_webhook_page(self):
        token = os.getenv("TELEGRAM_TOKEN", "–í–ê–®_–¢–û–ö–ï–ù")
        webhook_url = os.getenv("RENDER_EXTERNAL_URL", "https://konspekt-helper-bot.onrender.com") + "/webhook"
        
        html_content = f"""<!DOCTYPE html>
<html>
<head><title>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–µ–±—Ö—É–∫–∞</title></head>
<body>
<h1>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–µ–±—Ö—É–∫–∞ –¥–ª—è @Konspekt_help_bot</h1>
<p><strong>URL –≤–µ–±—Ö—É–∫–∞:</strong> {webhook_url}</p>
<p><strong>–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:</strong></p>
<pre>curl "https://api.telegram.org/bot{token}/setWebhook?url={webhook_url}"</pre>
<p><a href="/">–ù–∞ –≥–ª–∞–≤–Ω—É—é</a></p>
</body>
</html>"""
        
        self._set_headers()
        self.wfile.write(html_content.encode('utf-8'))
    
    def _process_update(self, update):
        token = os.getenv("TELEGRAM_TOKEN")
        if not token:
            logger.error("TELEGRAM_TOKEN –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")
            return
        
        bot = SimpleBot(token)
        
        if "message" in update:
            message = update["message"]
            chat_id = message["chat"]["id"]
            text = message.get("text", "").strip()
            update_id = update.get('update_id', 0)
            
            if text.startswith('/'):
                if text.startswith('/start'):
                    bot.start(update_id, chat_id)
                elif text.startswith('/help'):
                    bot.help_command(update_id, chat_id)
                elif text.startswith('/id'):
                    bot._send_message(chat_id, f"üÜî –í–∞—à Telegram ID: `{chat_id}`")
                elif text.startswith('/site'):
                    web_url = os.getenv("RENDER_EXTERNAL_URL", "https://konspekt-helper-bot.onrender.com")
                    bot._send_message(chat_id, f"üåê –í–µ–±-–ø–∞–Ω–µ–ª—å: {web_url}")
                elif text.startswith('/examples'):
                    bot.examples_command(update_id, chat_id)
                elif text.startswith('/conspect'):
                    conspect_text = text[9:].strip()
                    if conspect_text:
                        bot.process_text(update_id, chat_id, conspect_text)
                    else:
                        bot._send_message(chat_id, "üìù –£–∫–∞–∂–∏—Ç–µ —Ç–µ–º—É –ø–æ—Å–ª–µ –∫–æ–º–∞–Ω–¥—ã /conspect")
                else:
                    bot._send_message(chat_id, "‚ùì –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /help")
            elif text in ['1', '2', '3', '–∫—Ä–∞—Ç–∫–∏–π', '–ø–æ–¥—Ä–æ–±–Ω—ã–π', '—Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π']:
                bot.process_volume_choice(update_id, chat_id, text)
            elif text:
                bot.process_text(update_id, chat_id, text)
    
    def log_message(self, format, *args):
        pass

def start_bot():
    token = os.getenv("TELEGRAM_TOKEN")
    if not token:
        logger.error("TELEGRAM_TOKEN –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!")
        logger.info("–î–æ–±–∞–≤—å—Ç–µ TELEGRAM_TOKEN –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è Render")
        return
    
    bot = SimpleBot(token)
    logger.info("–ë–æ—Ç @Konspekt_help_bot —Å AI-–≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ")

def start_http_server():
    port = int(os.getenv("PORT", 10000))
    server_address = ('', port)
    
    httpd = HTTPServer(server_address, BotServer)
    logger.info(f"HTTP —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É {port}")
    logger.info(f"–í–µ–±-—Å–∞–π—Ç: http://localhost:{port}")
    logger.info(f"–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞: –≤–æ–π–Ω–∞ –∏ –µ—ë –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –æ–±—â–µ—Å—Ç–≤–æ")
    
    try:
        httpd.serve_forever()
    except KeyboardInterrupt:
        logger.info("–°–µ—Ä–≤–µ—Ä –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: {e}")

if __name__ == "__main__":
    logger.info("=" * 60)
    logger.info("–ó–∞–ø—É—Å–∫ @Konspekt_help_bot —Å AI-–≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –∫–æ–Ω—Å–ø–µ–∫—Ç–æ–≤")
    logger.info("=" * 60)
    
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è user_states –µ—Å–ª–∏ –Ω–µ—Ç
    if "user_states" not in stats:
        stats["user_states"] = {}
    
    token = os.getenv("TELEGRAM_TOKEN")
    if token:
        logger.info("TELEGRAM_TOKEN –Ω–∞–π–¥–µ–Ω")
    else:
        logger.warning("TELEGRAM_TOKEN –Ω–µ –Ω–∞–π–¥–µ–Ω!")
    
    bot_thread = threading.Thread(target=start_bot, daemon=True)
    bot_thread.start()
    
    start_http_server()
